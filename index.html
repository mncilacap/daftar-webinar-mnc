<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulir Pendaftaran</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-purple-50 flex justify-center p-5">

<div id="loading" class="hidden fixed inset-0 bg-white/80 z-50 flex flex-col items-center justify-center">
  <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-700"></div>
  <p class="mt-4 text-blue-900 font-medium">Sedang memproses...</p>
</div>

<div class="w-full max-w-xl bg-white rounded shadow p-6" id="mainContainer">

<h1 class="text-2xl font-bold text-blue-700 mb-4">FORMULIR PENDAFTARAN</h1>

<form id="guruForm" class="space-y-5">

  <input type="text" name="nama_lengkap" placeholder="Nama Lengkap + Gelar" required class="w-full border-b p-2">

  <input type="email" name="email" placeholder="Email" required class="w-full border-b p-2">

  <div class="grid grid-cols-2 gap-3">
    <input type="text" id="tempat_lahir" name="tempat_lahir" placeholder="Tempat Lahir" required class="border-b p-2">
    <input type="date" id="tgl_lahir" name="tgl_lahir" required class="border-b p-2">
  </div>

  <input type="hidden" name="tempat_tanggal_lahir" id="gabungan_ttl">

  <input type="text" name="nama_sekolah" placeholder="Nama Sekolah / Instansi" required class="w-full border-b p-2">

  <select id="jenjang" name="jenjang" required class="w-full border-b p-2">
    <option value="">Pilih Jenjang</option>
    <option>SD/MI</option>
    <option>SMP/MTs</option>
    <option>SMA/SMK/MA</option>
    <option>Lainnya</option>
  </select>

  <select id="mapel" name="mata_pelajaran" required disabled class="w-full border-b p-2">
    <option value="">Pilih Mata Pelajaran</option>
  </select>

  <input type="text" name="no_hp" placeholder="628xxxxxxxxxx" pattern="62[0-9]{9,15}" required class="w-full border-b p-2">

  <button type="submit" class="bg-blue-700 text-white px-6 py-2 rounded">Kirim</button>

  <div id="statusMsg" class="hidden p-3 text-center rounded"></div>

</form>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzLOeIxekpxZuDOm3TRHoOjk0f8pMZ3YuCXHQsu7J54IagSWj-FpEr1ufBUGn9X-Dfrhw/exec";

const mapelOptions = {
  "SD/MI": ["Guru Kelas 4","Guru Kelas 5","Guru Kelas 6"],
  "SMP/MTs": ["Guru Matematika 7","Guru Matematika 8","Guru Matematika 9"],
  "SMA/SMK/MA": ["Guru Matematika 10","Guru Matematika 11","Guru Matematika 12"],
  "Lainnya": ["-"]
};

document.getElementById("jenjang").onchange = function () {
  const mapel = document.getElementById("mapel");
  mapel.innerHTML = '<option value="">Pilih Mata Pelajaran</option>';
  mapel.disabled = false;
  mapelOptions[this.value].forEach(m => {
    let o = document.createElement("option");
    o.value = m;
    o.textContent = m;
    mapel.appendChild(o);
  });
};

document.getElementById("guruForm").addEventListener("submit", e => {
  e.preventDefault();

  document.getElementById("gabungan_ttl").value =
    document.getElementById("tempat_lahir").value + ", " +
    document.getElementById("tgl_lahir").value;

  document.getElementById("loading").classList.remove("hidden");

  fetch(SCRIPT_URL, {
    method: "POST",
    body: new FormData(e.target),
    mode: "no-cors"
  }).then(() => {
    localStorage.setItem("formSubmitted","true");
    showStatus("Pendaftaran berhasil. Terima kasih ðŸ™","bg-blue-100 text-blue-700");
    e.target.reset();
  }).catch(() => {
    showStatus("Gagal mengirim data","bg-red-100 text-red-700");
  }).finally(() => {
    document.getElementById("loading").classList.add("hidden");
  });
});

function showStatus(msg, cls){
  const el = document.getElementById("statusMsg");
  el.textContent = msg;
  el.className = "block p-3 rounded " + cls;
}
</script>

</body>
</html>
