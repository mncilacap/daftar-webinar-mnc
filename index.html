<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Pendaftaran</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f0ebf8;
            font-family: 'Roboto', 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        .form-wrapper {
            width: 100%;
            max-width: 640px;
        }
        .form-header-container {
            width: 100%;
            height: auto;
            background-color: #ffffff; 
            border-radius: 8px 8px 0 0;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .form-header-image {
            width: 100%;
            height: auto;
            display: block;
        }
        .header-divider {
            height: 4px;
            background-color: #1a73e8;
            width: 100%;
        }
        .google-card {
            background: white;
            border-radius: 8px;
            border: 1px solid #dadce0;
            margin-bottom: 12px;
            padding: 24px;
            position: relative;
        }
        .header-card {
            padding: 0;
            border-top: 10px solid #1a73e8;
            overflow: hidden;
        }
        .header-content {
            padding: 24px;
        }
        .header-card h1 {
            font-size: 28px;
            font-weight: 800; 
            text-transform: uppercase; 
            margin-bottom: 12px;
            color: #1a73e8;
        }
        .question-label {
            font-size: 18px;
            font-weight: 700;
            color: #1a73e8;
            margin-bottom: 15px;
            display: block;
        }
        .required-star {
            color: #d93025;
        }
        input, select {
            width: 100%;
            border: none;
            border-bottom: 1px solid #dadce0;
            padding: 8px 0;
            font-size: 14px;
            background: transparent;
        }
        input:focus, select:focus {
            outline: none;
            border-bottom: 2px solid #1a73e8;
        }
        .submit-btn {
            background-color: #1a73e8;
            color: white;
            padding: 10px 24px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            border: none;
        }
        .loading-spinner {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
    </style>
</head>
<body>

    <div id="loading" class="loading-spinner">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-700"></div>
        <p class="mt-4 text-blue-900 font-medium">Sedang memproses...</p>
    </div>

    <div class="form-wrapper" id="mainContainer">
        <div class="google-card header-card">
            <div class="form-header-container">
                <img src="https://i.postimg.cc/P5vS2xtV/Matematika-Nusantara.png" alt="Header" class="form-header-image">
            </div>
            <div class="header-divider"></div>
            <div class="header-content">
                <h1>FORMULIR PENDAFTARAN</h1>
                <p class="text-base text-gray-700 mb-2">
                    Silakan lengkapi formulir di bawah ini dengan benar untuk dapat mengikuti kegiatan webinar <b>Pemanfaatan Papan Interaksi Digital dengan Pembuatan Game Matematika.</b>
                </p>
                <p class="text-base text-gray-700">
                    Formulir akan ditutup pada tanggal <span class="text-red-600 font-bold">11 Pebruari 2026 pukul 15.00 WIB</span>
                </p>
                <hr class="my-4">
                <p class="text-sm text-red-600">* Menunjukkan pertanyaan yang wajib diisi</p>
            </div>
        </div>

        <form id="guruForm">
            <div class="google-card">
                <label class="question-label">Nama (Lengkap dengan Gelar) <span class="required-star">*</span></label>
                <input type="text" name="nama_lengkap" placeholder="Jawaban Anda" required>
            </div>

            <div class="google-card">
                <label class="question-label">Email <span class="required-star">*</span></label>
                <input type="email" name="email" placeholder="Jawaban Anda" required>
            </div>

            <div class="google-card">
                <label class="question-label">Tempat dan Tanggal Lahir <span class="required-star">*</span></label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="tempat_lahir" placeholder="Tempat Lahir" required>
                    <input type="date" id="tgl_lahir" required>
                </div>
                <input type="hidden" name="tempat_tanggal_lahir" id="gabungan_ttl">
            </div>

            <div class="google-card">
                <label class="question-label">Nama Sekolah/Instansi <span class="required-star">*</span></label>
                <input type="text" name="nama_sekolah" placeholder="Jawaban Anda" required>
            </div>

            <div class="google-card">
                <label class="question-label">Jenjang <span class="required-star">*</span></label>
                <select id="jenjang" name="jenjang" required onchange="updateMapel()">
                    <option value="" disabled selected>Pilih Jenjang</option>
                    <option value="SD/MI">SD/MI</option>
                    <option value="SMP/MTs">SMP/MTs</option>
                    <option value="SMA/SMK/MA">SMA/SMK/MA</option>
                    <option value="Lainnya">Lainnya</option>
                </select>
            </div>

            <div class="google-card">
                <label class="question-label">Mata Pelajaran <span class="required-star">*</span></label>
                <select id="mapel" name="mata_pelajaran" required disabled>
                    <option value="" disabled selected>Pilih Mata Pelajaran</option>
                </select>
            </div>

            <div class="google-card">
                <label class="question-label">No HP / WhatsApp <span class="required-star">*</span></label>
                <input type="text" name="no_hp" id="no_hp" placeholder="Contoh: 62812345678" pattern="62[0-9]{9,15}" title="Gunakan format 62 diawal" required>
                <p class="text-sm text-gray-500 mt-2">Format: 628xxxxxxxx (Gunakan 62)</p>
            </div>

            <div class="flex items-center justify-between mb-10">
                <button type="submit" id="submitBtn" class="submit-btn">Kirim</button>
                <button type="reset" class="text-blue-700 text-sm font-medium">Kosongkan formulir</button>
            </div>

            <div id="statusMsg" class="hidden p-4 rounded mb-10 text-center font-medium"></div>
        </form>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwt3sLDMcLs4N7_Jah-ajM9sXfH2u7fuc7VER2RW_0rIwxpknw5YTNm06Itxl-QAmraWw/exec";
        const DEADLINE_DATE = new Date(2026, 2, 11, 15, 0, 0);

        const mapelOptions = {
            "SD/MI": ["Guru Kelas 4", "Guru Kelas 5", "Guru Kelas 6"],
            "SMP/MTs": ["Guru Matematika Kelas 7", "Guru Matematika Kelas 8", "Guru Matematika Kelas 9"],
            "SMA/SMK/MA": ["Guru Matematika Kelas 10", "Guru Matematika Kelas 11", "Guru Matematika Kelas 12"],
            "Lainnya": ["-"]
        };

        function updateMapel() {
            const jenjang = document.getElementById('jenjang').value;
            const mapelSelect = document.getElementById('mapel');
            mapelSelect.innerHTML = '<option value="" disabled selected>Pilih Mata Pelajaran</option>';
            if (mapelOptions[jenjang]) {
                mapelSelect.disabled = false;
                mapelOptions[jenjang].forEach(item => {
                    let opt = document.createElement('option');
                    opt.value = item;
                    opt.innerHTML = item;
                    mapelSelect.appendChild(opt);
                });
                if (jenjang === "Lainnya") mapelSelect.value = "-";
            }
        }

        window.onload = () => {
            const now = new Date();
            if (now > DEADLINE_DATE) {
                document.getElementById('mainContainer').innerHTML = `<div class="google-card text-center py-10"><h2 class="text-2xl font-bold text-red-600">PENDAFTARAN DITUTUP</h2></div>`;
                return;
            }
            if (localStorage.getItem('formSubmitted')) {
                document.getElementById('guruForm').innerHTML = `<div class="google-card text-center py-10"><h2 class="text-xl font-bold text-gray-800">Anda sudah mengirimkan tanggapan untuk formulir ini.</h2></div>`;
            }
        };

        const form = document.getElementById('guruForm');
        const loading = document.getElementById('loading');
        const statusMsg = document.getElementById('statusMsg');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const tempat = document.getElementById('tempat_lahir').value;
            const tgl = document.getElementById('tgl_lahir').value;
            document.getElementById('gabungan_ttl').value = `${tempat}, ${tgl}`;

            loading.style.display = 'flex';
            const formData = new FormData(form);
            
            try {
                // Menggunakan mode 'no-cors' bisa membuat response kosong, tapi data tetap terkirim.
                // Namun untuk menangkap pesan error duplikasi dari script kita, kita coba mode default.
                const response = await fetch(SCRIPT_URL, { 
                    method: 'POST', 
                    body: formData
                });

                const result = await response.json();
                
                if (result.result === 'success') {
                    localStorage.setItem('formSubmitted', 'true');
                    showStatus("Pendaftaran berhasil! Terima kasih.", "bg-blue-100 text-blue-700");
                    setTimeout(() => window.location.reload(), 3000);
                } else {
                    showStatus(result.error || "Gagal menyimpan data.", "bg-red-100 text-red-700");
                }
            } catch (error) {
                // Perbaikan: Jangan langsung anggap sukses jika catch error.
                // Cek apakah error karena CORS tapi data mungkin masuk
                console.error(error);
                showStatus("Terjadi gangguan koneksi atau konfigurasi server. Jika Anda yakin belum mendaftar, silakan hubungi admin.", "bg-red-100 text-red-700");
            } finally {
                loading.style.display = 'none';
            }
        });

        function showStatus(msg, classes) {
            statusMsg.innerText = msg;
            statusMsg.className = `p-4 rounded mb-10 block ${classes}`;
            statusMsg.classList.remove('hidden');
        }
    </script>
</body>
</html>
